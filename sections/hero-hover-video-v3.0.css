/* ======================================================================
   A83 Header Hover Video — v3.0 (clean)
   Struktur: #show-max.show-max > .layer-img(img) + .layer-video(video)
   Ziele: 1:1 Ratio, identischer Top-Crop, BD-Wrapper-Fix, iOS-Hack, Glitch FX
   ====================================================================== */

/* ---------- Vars ---------- */
:root{
  /* Glitch-Timings */
  --gv-in: 720ms;       /* sichtbarer IN-Glitch */
  --gv-out: 520ms;      /* knackiger OUT-Glitch */
  --gv-overshoot: 1.015;

  /* Gemeinsamer Crop-Fokus für Bild & Video */
  --gv-crop-x: 50%;
  --gv-crop-y: 0%;      /* 0% = oben, 50% = Mitte */
}

/* ---------- Bühne (#show-max) ---------- */
#show-max.show-max{
  position: relative;
  width: 100%;
  aspect-ratio: 1 / 1;              /* 1:1, damit Image & Video identisch sind */
  overflow: hidden;
  border-radius: 14px;
  background: #0b0d0c;              /* safety */
  isolation: isolate;
}

/* Fallback ohne aspect-ratio */
@supports not (aspect-ratio: 1 / 1){
  #show-max.show-max{ height: 0; padding-top: 100%; }
}

/* ---------- Layer-Basis ---------- */
#show-max .layer-img,
#show-max .layer-video{
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
}

#show-max .layer-img{
  z-index: 1;
  transition: opacity .35s ease;
}

/* Video-Layer Startzustand (unsichtbar) */
#show-max .layer-video{
  z-index: 2;
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transition:
    opacity .35s ease,
    visibility 0s linear .35s,
    filter 240ms ease,
    transform 240ms ease;
  will-change: opacity, filter, transform;
}

/* Sichtbar (wird per JS/hover getoggelt) */
#show-max.show-video .layer-video{
  opacity: 1;
  visibility: visible;
  pointer-events: auto;
  transition:
    opacity .35s ease,
    visibility 0s linear 0s,
    filter 240ms ease,
    transform 240ms ease;
}
#show-max.show-video .layer-img{ opacity: 0; }

/* ---------- Breakdance Video-Wrapper Fix ---------- */
#show-max .layer-video,
#show-max .layer-video > div,
#show-max .layer-video > div > div,
#show-max .layer-video .breakdance-video,
#show-max .layer-video .breakdance-video-wrapper,
#show-max .layer-video .breakdance-video-container,
#show-max .layer-video .bd-video,
#show-max .layer-video .bd-video-container{
  position: absolute !important;
  inset: 0 !important;
  width: 100% !important;
  height: 100% !important;
  padding: 0 !important;
}

/* Ratio-Padding neutralisieren */
#show-max .layer-video [style*="padding-top"]{
  padding-top: 0 !important;
  height: 100% !important;
}

/* ---------- Medien: identischer Crop (Top) ---------- */
#show-max .layer-img img,
#show-max .layer-video video{
  display: block;
  width: 100% !important;
  height: 100% !important;
  max-width: none !important;
  max-height: none !important;
  object-fit: cover !important;
  object-position: var(--gv-crop-x) var(--gv-crop-y) !important;
  border-radius: inherit;
  background:#000;
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
}

/* iOS/Safari: harter Cover-Hack falls object-fit zickt (Top-Align) */
@supports (-webkit-touch-callout: none) {
  @media (max-width: 820px){
    #show-max .layer-video video{
      position: absolute !important;
      left: 50% !important;
      top: 0 !important;
      width: auto !important; height: auto !important;
      min-width: 100% !important; min-height: 100% !important;
      transform: translate(-50%, 0) !important;
    }
  }
}

/* Subpixel-Gaps killen (selten nötig) */
@media (max-width: 820px){
  #show-max .layer-video{ inset:-0.5px; }
  #show-max .layer-img  { inset:-0.5px; }
}

/* ---------- HARD GLITCH FX (Decor) ---------- */
/* Pseudo (Scanlines + RGB-Edge) */
#show-max .layer-video::before,
#show-max .layer-video::after{
  content:"";
  position: absolute; inset: -1px;
  border-radius: inherit;
  pointer-events: none;
  opacity: 0;
  z-index: 3;
}

/* IN/OUT aktivieren die Pseudos */
#show-max.gv-in .layer-video::before,
#show-max.gv-out .layer-video::before{
  opacity: .55;
  mix-blend-mode: screen;
  background:
    repeating-linear-gradient(
      to bottom,
      rgba(255,255,255,.12) 0,
      rgba(255,255,255,.12) 1px,
      transparent 2px,
      transparent 4px
    ),
    radial-gradient(circle at 20% 30%, rgba(255,255,255,.08), transparent 40%),
    radial-gradient(circle at 80% 70%, rgba(255,255,255,.08), transparent 40%);
  animation: gv-scan-strong var(--gv-in) linear both;
}
#show-max.gv-in .layer-video::after,
#show-max.gv-out .layer-video::after{
  opacity: 1;
  box-shadow:
    3px 0 0 rgba(0,255,255,.60) inset,
   -3px 0 0 rgba(255,0,128,.55) inset,
    0   0 0 1px color-mix(in oklab,var(--hcl-ruby-9,#e54666) 80%, transparent) inset;
  animation: gv-edge-jitter-strong var(--gv-in) steps(18) both;
}

@keyframes gv-scan-strong{
  0%{ transform: translateY(-85%); }
  100%{ transform: translateY(85%); }
}
@keyframes gv-edge-jitter-strong{
  0%,100%{ transform: translateX(0) skewX(0deg); }
  15%{ transform: translateX(3px)  skewX(.5deg); }
  30%{ transform: translateX(-3px) skewX(-.5deg); }
  45%{ transform: translateX(3px)  skewX(.5deg); }
  60%{ transform: translateX(-3px) skewX(-.5deg); }
  75%{ transform: translateX(2px)  skewX(.35deg); }
}

/* Slice-Glitch-Stripes (.gv-slices > .gv-slice per JS) */
#show-max .gv-slices{
  position: absolute; inset: 0;
  border-radius: inherit;
  pointer-events: none;
  z-index: 4;
}
#show-max .gv-slice{
  position: absolute;
  left: -10px; right: -10px;
  background: linear-gradient(90deg,
    rgba(0,255,255,.30),
    rgba(255,0,128,.28) 40%,
    rgba(255,255,255,.15) 60%,
    rgba(0,0,0,0));
  mix-blend-mode: screen;
  filter: saturate(1.35) contrast(1.08);
  will-change: transform;
}
@keyframes gv-slice-shift{
  0%{ transform: translateX(0) }
  25%{ transform: translateX(10px) }
  50%{ transform: translateX(-12px) }
  75%{ transform: translateX(6px) }
  100%{ transform: translateX(0) }
}
@keyframes gv-slice-skew{
  0%{ transform: translateX(0) skewX(0deg) }
  20%{ transform: translateX(-8px) skewX(-.8deg) }
  50%{ transform: translateX(7px)  skewX(.8deg) }
  80%{ transform: translateX(-4px) skewX(-.5deg) }
  100%{ transform: translateX(0) skewX(0deg) }
}

/* Tear Bars (.gv-bars per JS) */
#show-max .gv-bars{
  position: absolute; inset: 0;
  z-index: 5; pointer-events: none;
  background:
    repeating-linear-gradient(
      to bottom,
      rgba(255,255,255,0) 0 18%,
      rgba(255,255,255,.07) 18% 19%,
      rgba(255,255,255,0) 19% 40%
    );
  mix-blend-mode: screen;
  opacity: 0;
  animation: gv-bars-flash var(--gv-in) steps(12) both;
}
@keyframes gv-bars-flash{
  0%{ opacity: 0; }
  15%{ opacity: .35; }
  45%{ opacity: .18; }
  70%{ opacity: .30; }
  100%{ opacity: 0; }
}

/* Overshoot/Punch auf der Video-Layer */
#show-max.gv-kick .layer-video{
  transform: scale(var(--gv-overshoot)) translateZ(0);
  filter: saturate(1.22) contrast(1.08);
}
#show-max.gv-relax .layer-video{
  transform: scale(1) translateZ(0);
  filter: none;
}

/* Motion-Respect */
@media (prefers-reduced-motion: reduce){
  #show-max .layer-video,
  #show-max .layer-video::before,
  #show-max .layer-video::after,
  #show-max .gv-slice,
  #show-max .gv-bars{
    animation: none !important;
    transition: none !important;
  }
}